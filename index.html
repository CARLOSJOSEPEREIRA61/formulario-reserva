<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Reserva de UH</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 30px; }
    label { display: block; margin-top: 12px; }
    input, select, button { width: 100%; padding: 10px; margin-top: 5px; }
    #resultadoPlanilha {
      margin-top: 40px;
      border-collapse: collapse;
      width: 100%;
    }
    #resultadoPlanilha td, #resultadoPlanilha th {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>Reserva de UH</h2>

  <form id="reservaForm">
    <label for="checkin">Data de Check-in:</label>
    <input type="date" name="checkin" id="checkin" required>

    <label for="checkout">Data de Check-out:</label>
    <input type="date" name="checkout" id="checkout" required>

    <label for="uh">Unidade Habitacional (UH):</label>
    <select name="uh" id="uh" required>
      <option value="">-- Selecione a UH --</option>
      <option>01 Amora Mel</option>
      <option>02 Francisco</option>
      <option>03 Luna</option>
      <option>04 Teca</option>
      <option>05 Bento</option>
      <option>06 Luca</option>
      <option>07 Augusto</option>
      <option>08 Marie Lili</option>
      <option>09 Leo</option>
      <option>10 Nino</option>
      <option>11 Tony</option>
      <option>12 Kiko</option>
      <option>13 Anita</option>
      <option>14</option>
      <option>15</option>
      <option>16</option>
      <option>17</option>
      <option>18</option>
      <option>19</option>
      <option>20</option>
    </select>

    <label for="origem">Origem da Reserva:</label>
    <select name="origem" id="origem" required>
      <option value="">-- Selecione a origem --</option>
      <option>1 AirBnB</option>
      <option>2 Booking</option>
      <option>3 Avulso</option>
    </select>

    <button type="submit">Enviar Reserva</button>
  </form>

  <div id="mensagem" style="margin-top: 20px; font-weight: bold;"></div>

  <h3>Visualização da Planilha REG (E50:L80)</h3>
  <table id="resultadoPlanilha"></table>

  <script>
    const form = document.getElementById("reservaForm");
    const checkin = document.getElementById("checkin");
    const checkout = document.getElementById("checkout");

    // Define hoje como mínimo para check-in
    const hoje = new Date();
    checkin.min = hoje.toISOString().split('T')[0];

    checkin.addEventListener("change", () => {
      const data = new Date(checkin.value);
      data.setDate(data.getDate() + 1);
      checkout.min = data.toISOString().split('T')[0];
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const dados = new FormData(form);
      const url = "https://script.google.com/macros/s/AKfycbxejM3fEJ6HtGyuq-vVubKB5d65ZR8EDP_uVHeOwdEIVsKE50wKaUFv5y1L9XYfP9QdDQ/exec";

      try {
        const resposta = await fetch(url, {
          method: "POST",
          body: dados
        });

        const texto = await resposta.text();
        document.getElementById("mensagem").innerText = texto;

        form.reset();
        checkin.focus();

        carregarTabela();
      } catch (err) {
        document.getElementById("mensagem").innerText = "Erro ao enviar reserva.";
        console.error(err);
      }
    });

    async function carregarTabela() {
      const url = "https://script.google.com/macros/s/AKfycbxejM3fEJ6HtGyuq-vVubKB5d65ZR8EDP_uVHeOwdEIVsKE50wKaUFv5y1L9XYfP9QdDQ/exec?action=lerRange";

      try {
        const resposta = await fetch(url);
        const dados = await resposta.json();

        const tabela = document.getElementById("resultadoPlanilha");
        tabela.innerHTML = "";

        dados.forEach(linha => {
          const tr = document.createElement("tr");
          linha.forEach(celula => {
            const td = document.createElement("td");
            td.textContent = celula.valor;
            td.style.backgroundColor = celula.bgColor;
            td.style.color = celula.textColor;
            if (celula.bold) td.style.fontWeight = "bold";
            tr.appendChild(td);
          });
          tabela.appendChild(tr);
        });
      } catch (err) {
        document.getElementById("resultadoPlanilha").innerHTML = "<tr><td colspan='8'>Erro ao carregar a planilha.</td></tr>";
        console.error(err);
      }
    }

    carregarTabela(); // Inicializa ao carregar a página
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Formulário de Reserva</title>
  <style>
    body {
      font-family: Arial;
      max-width: 700px;
      margin: auto;
      padding-top: 40px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    table {
      width: 100%;
      margin-top: 30px;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #aaa;
    }
    td {
      padding: 6px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>Reserva de UH</h2>

  <form id="reservaForm" action="https://script.google.com/macros/s/AKfycbxejM3fEJ6HtGyuq-vVubKB5d65ZR8EDP_uVHeOwdEIVsKE50wKaUFv5y1L9XYfP9QdDQ/exec" method="POST">
    <label for="checkin">Data de Check-in:</label>
    <input type="date" name="checkin" id="checkin" required>

    <label for="checkout">Data de Check-out:</label>
    <input type="date" name="checkout" id="checkout" required>

    <label for="uh">Unidade Habitacional (UH):</label>
    <select name="uh" id="uh" required>
      <option value="">-- Selecione a UH --</option>
      <option>01 Amora Mel</option>
      <option>02 Francisco</option>
      <option>03 Luna</option>
      <option>04 Teca</option>
      <option>05 Bento</option>
      <option>06 Luca</option>
      <option>07 Augusto</option>
      <option>08 Marie Lili</option>
      <option>09 Leo</option>
      <option>10 Nino</option>
      <option>11 Tony</option>
      <option>12 Kiko</option>
      <option>13 Anita</option>
      <option>14</option>
      <option>15</option>
      <option>16</option>
      <option>17</option>
      <option>18</option>
      <option>19</option>
      <option>20</option>
    </select>

    <label for="origem">Origem da Reserva:</label>
    <select name="origem" id="origem" required>
      <option value="">-- Selecione a origem --</option>
      <option>1 AirBnB</option>
      <option>2 Booking</option>
      <option>3 Avulso</option>
    </select>

    <button type="submit">Enviar Reserva</button>
  </form>

  <h3>Visualização da Planilha (E50:L80)</h3>
  <table id="tabelaPlanilha"></table>

  <script>
    const checkin = document.getElementById('checkin');
    const checkout = document.getElementById('checkout');
    const uh = document.getElementById('uh');
    const origem = document.getElementById('origem');
    const form = document.getElementById('reservaForm');

    // Define hoje como mínimo para check-in
    const hoje = new Date();
    const hojeISO = hoje.toISOString().split('T')[0];
    checkin.min = hojeISO;

    // Atualiza mínimo do checkout quando check-in muda
    checkin.addEventListener('change', function () {
      if (checkin.value) {
        const dataCheckin = new Date(checkin.value);
        const dataMinCheckout = new Date(dataCheckin);
        dataMinCheckout.setDate(dataCheckin.getDate() + 1);
        checkout.min = dataMinCheckout.toISOString().split('T')[0];

        if (checkout.value && checkout.value <= checkin.value) {
          checkout.value = '';
        }

        checkout.focus(); // Avança
      }
    });

    // Foco automático para os campos seguintes
    checkout.addEventListener('change', () => uh.focus());
    uh.addEventListener('change', () => origem.focus());

    // Impede envio com campos incompletos
    form.addEventListener('submit', function (e) {
      if (!checkin.value || !checkout.value || !uh.value || !origem.value) {
        e.preventDefault();
        alert('Por favor, preencha todos os campos antes de enviar.');
      }
    });

    // Carrega os dados da planilha (range E50:L80)
    async function carregarTabela() {
      try {
        const resposta = await fetch('https://script.google.com/macros/s/AKfycbxejM3fEJ6HtGyuq-vVubKB5d65ZR8EDP_uVHeOwdEIVsKE50wKaUFv5y1L9XYfP9QdDQ/exec?action=lerRange');
        const dados = await resposta.json();

        const tabela = document.getElementById('tabelaPlanilha');
        tabela.innerHTML = '';

        dados.forEach(linha => {
          const tr = document.createElement('tr');
          linha.forEach(celula => {
            const td = document.createElement('td');
            td.innerText = celula.valor || '';
            td.style.backgroundColor = celula.bgColor || 'white';
            td.style.color = celula.textColor || 'black';
            td.style.fontWeight = celula.bold ? 'bold' : 'normal';
            tr.appendChild(td);
          });
          tabela.appendChild(tr);
        });
      } catch (erro) {
        console.error('Erro ao carregar a tabela:', erro);
      }
    }

    window.onload = carregarTabela;
  </script>

</body>
</html>
